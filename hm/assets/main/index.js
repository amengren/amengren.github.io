System.register("chunks:///_virtual/JsonUtils.ts",["cc","./GameUtil.ts"],(function(e){"use strict";var t,n,s,i,o;return{setters:[function(e){t=e.cclegacy,n=e.resources,s=e.JsonAsset,i=e.error},function(e){o=e.GameUtil}],execute:function(){t._RF.push({},"094ae3JcHpOdaeicG3S5ROh","JsonUtils",void 0);var a=new Map;e("JsonUtil",function(){function e(){}return e.get=function(e){if(a.has(e))return a.get(e)},e.load=function(e,t){if(a.has(e))t(a.get(e));else{var r=o.inst.getConfigPath(e);n.load(r,s,(function(n,s){n&&i(n.message),a.set(e,s.json),t(s.json)}))}},e.loadAsync=function(e){return new Promise((function(t,r){if(a.has(e))t(a.get(e));else{var c=o.inst.getConfigPath(e);n.load(c,s,(function(n,s){n&&i(n.message),a.set(e,s.json),t(s.json)}))}}))},e.release=function(e){var t=o.inst.getConfigPath(e);a.delete(e),n.release(t)},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/CommonTips.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./fairygui.mjs","./BaseLayer.ts"],(function(t){"use strict";var e,o,i,r,n,s,a,c,l;return{setters:[function(t){e=t.cclegacy,o=t._decorator},function(t){i=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){a=t.UIPackage,c=t.GRoot},function(t){l=t.BaseLayer}],execute:function(){var p,u,f;e._RF.push({},"1d6ffkXNW1ECZ7UBzAa1m4j","CommonTips",void 0);var m=o.ccclass,y=o.property;t("CommonTips",m("CommonTips")((f=i((u=function(t){function e(){for(var e,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,n(s(e),"_tipsTxt",f,s(e)),e}r(e,t);var o=e.prototype;return o.show=function(t){var o=a.createObject("Common","Common_Tips",e);o.makeFullScreen(),c.inst.addChild(o),o._tipsTxt=t,o.getChild("txt").text=t,setTimeout((function(){o.Close()}),1e3)},o.start=function(){t.prototype.start.call(this)},o.Close=function(){t.prototype.Close.call(this)},e}(l)).prototype,"_tipsTxt",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),p=u))||p);e._RF.pop()}}}));

System.register("chunks:///_virtual/CreateConfirmView.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameUtil.ts","./fairygui.mjs","./BaseLayer.ts"],(function(e){"use strict";var t,i,n,o,a,s,r,l,c,h,u,C;return{setters:[function(e){t=e.cclegacy,i=e._decorator,n=e.resources,o=e.sp,a=e.Vec2},function(e){s=e.inheritsLoose,r=e.defineProperty,l=e.assertThisInitialized},function(e){c=e.GameUtil},function(e){h=e.UIPackage,u=e.GRoot},function(e){C=e.BaseLayer}],execute:function(){var d;t._RF.push({},"3fc273eA5pMaYyewOGdFM4A","CreateConfirmView",void 0);var p=i.ccclass;i.property,e("CreateConfirmView",p("CreateConfirmView")(d=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,r(l(t),"roleName",null),r(l(t),"roleSpine",null),r(l(t),"data",void 0),t}s(t,e),t.show=function(e){console.log("添加添加");var i=h.createObject("CreateRole","CreateConfirmView",t);i.makeFullScreen(),u.inst.addChild(i),i.data=e,i.start()};var i=t.prototype;return i.start=function(){e.prototype.start.call(this),this.roleName=this.getChild("roleName"),this.roleSpine=this.getChild("roleSpine");var t=this.getChild("n0").asCom;t.getChild("cancelBtn").onClick(this.Close.bind(this)),t.getChild("n7").asCom.getChild("closeBtn").onClick(this.Close.bind(this)),t.getChild("sureBtn").onClick(this.sureBtnClicked.bind(this)),this.data.Spine&&n.load("SPINE/hero_json/"+this.data.Spine,o.SkeletonData,(function(){}),this.onComplete.bind(this)),this.roleName.text=this.data.RoleName},i.onComplete=function(e,t){var i=new a(0,1);this.roleSpine.setSpine(t,i,!1);var n=this.roleSpine.content;n.animation="stand",this.data.Skin&&n.setSkin(this.data.Skin)},i.sureBtnClicked=function(){c.eventTarget.emit("SHOW_COMMON_TIPS",{data:"create role sucess!"}),this.Close()},i.Close=function(){e.prototype.Close.call(this)},t}(C))||d);t._RF.pop()}}}));

System.register("chunks:///_virtual/main.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./fairygui.mjs","./BagLayer.ts"],(function(o){"use strict";var n,e,t,i,a,r,c,s,l,u,f,d,m,p;return{setters:[function(o){n=o.cclegacy,e=o._decorator,t=o.resources,i=o.Font,a=o.Component},function(o){r=o.applyDecoratedDescriptor,c=o.inheritsLoose,s=o.initializerDefineProperty,l=o.assertThisInitialized},function(o){u=o.GRoot,f=o.registerFont,d=o.UIConfig,m=o.UIPackage},function(o){p=o.BagLayer}],execute:function(){var g,y,h;n._RF.push({},"5647e3O0C5CaKnC+cb7UocV","main",void 0);var F=e.ccclass,b=e.property;o("main",F("main")((h=r((y=function(o){function n(){for(var n,e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n=o.call.apply(o,[this].concat(t))||this,s(l(n),"serializableDummy",h,l(n)),n}c(n,o);var e=n.prototype;return e.onCommonLoaded=function(){u.create(),t.load("Fonts/fzy4k",i,null,(function(o,n){console.log(o),f("fzy4k",n)})),t.load("Fonts/FRADM_temp",i,null,(function(o,n){console.log(o),f("FRADM",n)})),d.defaultFont="FRADM",m.loadPackage("FGUI/fgui_bag",this.onUILoaded.bind(this))},e.onLoad=function(){console.log("main is onLoad!!!"),m.loadPackage("FGUI/Common",this.onCommonLoaded.bind(this))},e.onUILoaded=function(){p.show()},e.start=function(){console.error("main is start!!!")},n}(a)).prototype,"serializableDummy",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g=y))||g);n._RF.pop()}}}));

System.register("chunks:///_virtual/CreateRoleView.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameUtil.ts","./fairygui.mjs","./BaseLayer.ts","./CreateConfirmView.ts","./ConfigUtil.ts"],(function(t){"use strict";var e,i,n,l,o,r,s,a,c,u,h,p,f,m,d,b,C;return{setters:[function(t){e=t.cclegacy,i=t._decorator,n=t.resources,l=t.sp,o=t.Vec2},function(t){r=t.applyDecoratedDescriptor,s=t.inheritsLoose,a=t.initializerDefineProperty,c=t.assertThisInitialized,u=t.defineProperty},function(t){h=t.GameUtil},function(t){p=t.UIPackage,f=t.GRoot,m=t.Event},function(t){d=t.BaseLayer},function(t){b=t.CreateConfirmView},function(t){C=t.ConfigUtil}],execute:function(){var I,g,_,x,y,S,T,v,w,k,R,L;e._RF.push({},"879e8nM+DFB86FdEv7I+35y","CreateRoleView",void 0);var N=i.ccclass,z=i.property;t("CreateRoleView",N("CreateRoleView")((_=r((g=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n))||this,a(c(e),"topInfo",_,c(e)),a(c(e),"title",x,c(e)),a(c(e),"inputTxt",y,c(e)),a(c(e),"selectList",S,c(e)),a(c(e),"list1",T,c(e)),a(c(e),"list2",v,c(e)),a(c(e),"list3",w,c(e)),a(c(e),"roleSelectIdx",k,c(e)),a(c(e),"roleSpine",R,c(e)),a(c(e),"spine",L,c(e)),u(c(e),"skinName",null),u(c(e),"_tableName","CharacterTemplate"),u(c(e),"_tableInfo",null),u(c(e),"_roleNum",0),u(c(e),"_selectData",null),e}s(e,t),e.show=function(){console.log("添加添加");var t=p.createObject("CreateRole","CreateRoleView",e);t.makeFullScreen(),f.inst.addChild(t),t.start()};var i=e.prototype;return i.start=function(){var e=this;t.prototype.start.call(this),this._tableInfo=C.getTable(this._tableName),this._roleNum=C.getTableLen(this._tableName),this.inputTxt=this.getChild("inputTxt");var i=this.inputTxt.promptText;this.inputTxt.on(m.TOUCH_BEGIN,(function(){e.inputTxt.promptText=""})),this.inputTxt.on(m.TOUCH_END,(function(){e.inputTxt.promptText=i})),this.topInfo=this.getChild("topInfo"),this.topInfo.getChild("closeBtn").onClick((function(){console.log("closeBtn"),e.Close()}),this),this.title=this.topInfo.getChild("title"),this.title.text="Create Role",this.getChild("sureBtn").onClick(this.onConfirmBtnClicked.bind(this)),this.roleSpine=this.getChild("roleSpine");var n=this.getChild("selectList");this.selectList=n,n.on(m.CLICK_ITEM,this.onClickItem,this),n.itemRenderer=this.renderListItem,n.numItems=this._roleNum,n.selectedIndex=0,this._selectData=this._tableInfo[1];var l=this.getChild("list1");this.list1=l,l.on(m.CLICK_ITEM,this.onClickItem1,this),l.itemRenderer=this.renderListItem1.bind(this),l.numItems=3,l.selectedIndex=0,this.refreshRoleSpine()},i.Close=function(){t.prototype.Close.call(this)},i.renderListItem=function(t,e){e.getChild("iconImg").url="RES/Icon/role_icon_1png"},i.onClickItem=function(t){var e=this.selectList.selectedIndex+1;this._selectData=this._tableInfo[e],this.refreshRoleSpine()},i.refreshRoleSpine=function(){if(this.roleSelectIdx!=this.selectList.selectedIndex){var t=Math.floor(10*Math.random())%3;this.list1.selectedIndex=t,n.load("SPINE/hero_json/"+this._selectData.Spine,l.SkeletonData,this.onProcess.bind(this),this.onComplete.bind(this))}},i.onProcess=function(t,e){},i.onComplete=function(t,e){var i=new o(0,1);this.roleSpine.setSpine(e,i,!1),this.spine=this.roleSpine.content,this.spine.animation="stand";var n=this.list1.selectedIndex+1;console.log("=idx====",n),n>2&&(n=2),this.spine.setSkin("a"+n),this.skinName="a"+n},i.renderListItem1=function(t,e){var i=e,n=this._selectData["Icon"+(t+1)];console.log(t,"num=",n),i.getChild("color").url="ui://CreateRole/role_img_s"+n},i.onClickItem1=function(t){var e=this.list1.selectedIndex+1;e>2&&(e=2),this.spine.setSkin("a"+e),this.skinName="a"+e},i.onConfirmBtnClicked=function(){if(console.log("输入文本："+this.inputTxt.text),this.inputTxt.text&&""!=this.inputTxt.text){var t=new Array;t.Spine=this._selectData.Spine,t.RoleName=this.inputTxt.text,t.Skin=this.skinName,b.show(t)}else h.eventTarget.emit("SHOW_COMMON_TIPS",{data:"nickname is null!"})},i.test=function(){var t=this._tableInfo[1];console.log(this._tableInfo);var e=0;for(var i in this._tableInfo)e++;console.log("====长度===",e,t.StartTime);var n=Object.keys(this._tableInfo);console.log("====22222222===",n,n.length)},e}(d)).prototype,"topInfo",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=r(g.prototype,"title",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=r(g.prototype,"inputTxt",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=r(g.prototype,"selectList",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=r(g.prototype,"list1",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(g.prototype,"list2",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=r(g.prototype,"list3",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=r(g.prototype,"roleSelectIdx",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=r(g.prototype,"roleSpine",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=r(g.prototype,"spine",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=g))||I);e._RF.pop()}}}));

System.register("chunks:///_virtual/GameUtil.ts",["cc","./_rollupPluginModLoBabelHelpers.js"],(function(t){"use strict";var n,e,r,i,o;return{setters:[function(t){n=t.cclegacy,e=t._decorator,r=t.EventTarget},function(t){i=t.defineProperty,o=t.createClass}],execute:function(){var a,u,c;n._RF.push({},"8d831SPOStFwZitFuiZMUii","GameUtil",void 0);var s=e.ccclass;e.property,t("GameUtil",s("GameUtil")((c=u=function(){function t(){}var n=t.prototype;return n.test=function(){},n.getConfigPath=function(t){return"DATA/"+t},n.PointAngle=function(t,n){return Math.atan2(n.y-t.y,n.x-t.x)},n.AngleOffset=function(t,n){n>Math.PI/2&&(n%=Math.PI/2);var e=Math.abs(t),r=e+n;r>Math.PI&&(r=-(Math.PI-(r-Math.PI)));var i=e-n;return i<0&&(i=i),[r*t/Math.abs(t),i*t/Math.abs(t)]},n.Point2PointFAngle=function(t,n,e){var r=n*Math.cos(e),i=n*Math.sin(e);return console.log("x1="+t.x+" y1="+t.y),console.log("x="+(t.x+r)+" y="+t.y+i),{x:t.x+r,y:t.y+i}},n.PointTheta=function(t,n){return Math.atan2(n.y-t.y,n.x-t.x)*(180/Math.PI)},n.PointToPointFspeed=function(t,n,e){var r=this.PointAngle(t,n),i=this.Point2PointFAngle(t,e,r);return[i,this.PixToSpeed(i,n)<e]},n.AngleToTheta=function(t){return t*(180/Math.PI)},n.getPixAndPixCenter=function(t,n,e){return void 0===e&&(e=null),e||(e=2),{x:Math.floor((t.x+n.x)/e),y:Math.floor((t.y+n.y)/e)}},n.PixToSpeed=function(t,n){return Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))},o(t,null,[{key:"inst",get:function(){return t._inst||(t._inst=new t),t._inst}},{key:"eventTarget",get:function(){return t._eventTarget||(t._eventTarget=new r),t._eventTarget}}]),t}(),i(u,"_inst",void 0),i(u,"_eventTarget",void 0),a=c))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/ConfigUtil.ts",["cc","./JsonUtils.ts"],(function(t){"use strict";var n,e;return{setters:[function(t){n=t.cclegacy},function(t){e=t.JsonUtil}],execute:function(){n._RF.push({},"938caj4DdlB5b5k3NA0D+S+","ConfigUtil",void 0);t("ConfigUtil",function(){function t(){}return t.getTable=function(t){return e.get(t)},t.getTableLen=function(n){var e=t.getTable(n);return Object.keys(e).length},t.getConfigById=function(n,e){var r=t.getTable(n),i=null;for(var u in r){var o=r[u];if(o.Id==e){i=o;break}}return i},t.getConfigValue=function(n,e,r){var i=t.getTable(n),u=null;for(var o in i){var c=i[o];if(c.Id==e){u=c[r];break}}return u},t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingView.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameUtil.ts","./JsonUtils.ts","./fairygui.mjs","./BaseLayer.ts","./CreateRoleView.ts"],(function(e){"use strict";var t,n,o,r,i,s,a,c,u,l,f;return{setters:[function(e){t=e.cclegacy,n=e._decorator,o=e.resources},function(e){r=e.inheritsLoose,i=e.asyncToGenerator},function(e){s=e.GameUtil},function(e){a=e.JsonUtil},function(e){c=e.UIPackage,u=e.GRoot},function(e){l=e.BaseLayer},function(e){f=e.CreateRoleView}],execute:function(){var p;t._RF.push({},"a777arVc9ZLyatKMrjev+3e","LoadingView",void 0);var g=n.ccclass;n.property,e("LoadingView",g("LoadingView")(p=function(e){function t(){return e.apply(this,arguments)||this}r(t,e),t.show=function(){console.log("添加添加");var e=c.createObject("Loading","LoadingView",t);e.makeFullScreen(),u.inst.addChild(e),e.start()};var n=t.prototype;return n.start=function(){var e=i(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadCustom();case 2:this.loadRes();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.loadCustom=function(){return new Promise(function(){var e=i(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.loadAsync("ActivityTemplate");case 2:return e.next=4,a.loadAsync("CharacterTemplate");case 4:t(null);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},n.loadRes=function(){console.log("===loadRes======"),o.loadDir("RES",this.onProgress.bind(this),this.onComplete.bind(this))},n.onProgress=function(e,t,n){},n.onComplete=function(){var e=this;c.loadPackage("FGUI/CreateRole",(function(){f.show(),e.Close()}))},n.Close=function(){e.prototype.Close.call(this)},n.RegisterEvents=function(){var t=this;e.prototype.RegisterEvents.call(this),s.eventTarget.on("LoginSucess",(function(){t.Close()}),this)},n.UnregisterEvents=function(){e.prototype.UnregisterEvents.call(this),s.eventTarget.off("LoginSucess",(function(){}),this)},t}(l))||p);t._RF.pop()}}}));

System.register("chunks:///_virtual/BagLayer.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameUtil.ts","./fairygui.mjs","./BaseLayer.ts","./CommonTips.ts","./LoadingView.ts"],(function(t){"use strict";var o,e,n,i,s,a,r,c,l;return{setters:[function(t){o=t.cclegacy,e=t._decorator},function(t){n=t.inheritsLoose},function(t){i=t.GameUtil},function(t){s=t.UIPackage,a=t.GRoot},function(t){r=t.BaseLayer},function(t){c=t.CommonTips},function(t){l=t.LoadingView}],execute:function(){var u;o._RF.push({},"a7f8bEia/5DEaD2IADBhYW6","BagLayer",void 0);var f=e.ccclass;e.property,t("BagLayer",f("BagLayer")(u=function(t){function o(){return t.apply(this,arguments)||this}n(o,t),o.show=function(){var t=s.createObject("fgui_bag","main",o);t.makeFullScreen(),a.inst.addChild(t),t.start()};var e=o.prototype;return e.start=function(){t.prototype.start.call(this),this.getChild("n1").onClick((function(){console.log("btn n1"),i.eventTarget.emit("BAGLAYER_foobar",{data:1})}),this),this.getChild("n2").onClick((function(){console.log("btn n1"),s.loadPackage("FGUI/Loading",(function(){l.show()}))}),this)},e.Close=function(){t.prototype.Close.call(this)},e.RegisterEvents=function(){t.prototype.RegisterEvents.call(this),i.eventTarget.on("BAGLAYER_foobar",this._sayHello,this),i.eventTarget.on("SHOW_COMMON_TIPS",this._showTips,this)},e.UnregisterEvents=function(){t.prototype.UnregisterEvents.call(this),i.eventTarget.off("BAGLAYER_foobar",this._sayHello,this)},e._sayHello=function(t){console.log("Hello World="+t.data),this.Close(),setTimeout((function(){o.show()}),1e3)},e._showTips=function(t){console.log("Tips TXT ="+t.data),(new c).show(t.data)},o}(r))||u);o._RF.pop()}}}));

System.register("chunks:///_virtual/player.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameUtil.ts"],(function(e){"use strict";var t,i,a,o,s,h,n,l,r,p,d,c,f,y,M,P,u,v,g,m;return{setters:[function(e){t=e.cclegacy,i=e._decorator,a=e.Prefab,o=e.view,s=e.find,h=e.sp,n=e.input,l=e.Input,r=e.TiledMap,p=e.KeyCode,d=e.Component,c=e.instantiate,f=e.resources,y=e.TiledMapAsset},function(e){M=e.applyDecoratedDescriptor,P=e.inheritsLoose,u=e.initializerDefineProperty,v=e.assertThisInitialized,g=e.defineProperty},function(e){m=e.GameUtil}],execute:function(){var w,S,K,Y,E;t._RF.push({},"c7e6asV7vtCL6CorJakTEXc","player",void 0);var x=i.ccclass,A=i.property;e("player",(w=x("player"),S=A({type:a}),w((E=M((Y=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,u(v(t),"mapPab",E,v(t)),g(v(t),"worldPlayerX",1e3),g(v(t),"worldPlayerY",400),g(v(t),"worldMapX",0),g(v(t),"worldMapY",0),g(v(t),"cellWidth",64),g(v(t),"cellHeight",64),g(v(t),"worldMapWidth",300*t.cellWidth),g(v(t),"worldMapHeight",300*t.cellHeight),g(v(t),"mapSizeWidth",20*t.cellWidth),g(v(t),"mapSizeHeight",20*t.cellHeight),g(v(t),"FrameTime",.034),g(v(t),"MapNode",null),g(v(t),"PlayerNode",null),g(v(t),"PlayerSpine",null),g(v(t),"viewSize",void 0),g(v(t),"KeyOffX",0),g(v(t),"KeyOffY",0),g(v(t),"SPEED",9),g(v(t),"mapSizeY",t.worldMapHeight/t.mapSizeHeight),g(v(t),"memMapIndexX",-1),g(v(t),"memMapIndexY",-2),g(v(t),"moveAngle",null),t}P(t,e);var i=t.prototype;return i.start=function(){console.log("start init"),this.viewSize=o.getVisibleSize(),console.log("start init="+this.viewSize.width,this.viewSize.height),this.MapNode=s("Canvas/MapNode"),this.PlayerNode=s("Canvas/PlayerNode/player"),this.PlayerSpine=this.PlayerNode.getComponent(h.Skeleton),this.upDateMap(!0)},i.upDateMap=function(e){void 0===e&&(e=!1),this.worldMapX=-this.worldPlayerX,this.worldMapY=-this.worldPlayerY,this.worldMapX>0-this.viewSize.width/2?this.worldMapX=0-this.viewSize.width/2:this.worldMapX<-this.worldMapWidth+this.viewSize.width/2&&(this.worldMapX=-this.worldMapWidth+this.viewSize.width/2),this.worldMapY>0-this.viewSize.height/2?this.worldMapY=0-this.viewSize.height/2:this.worldMapY<this.viewSize.height/2-this.worldMapHeight&&(this.worldMapY=this.viewSize.height/2-this.worldMapHeight),this.MapNode.setPosition(this.worldMapX,this.worldMapY),this.loadMap(e),this.upDatePlayerLocal()},i.loadMap=function(e){var t=this;void 0===e&&(e=!1);var i=Math.floor(this.worldPlayerX/this.mapSizeWidth),a=Math.floor(this.worldPlayerY/this.mapSizeHeight);if(i!=this.memMapIndexX||a!=this.memMapIndexY){this.memMapIndexX=i,this.memMapIndexY=a;var o=this.MapNode.children;for(var h in o){var n=o[h].name.split("_"),l=Number(n[1]),p=Number(n[2]);(l<i-1||l>i+1||p<a-1||p>a+1)&&o[h].destroy()}for(var d=-1;d<=1;d++)for(var M=function(o){var h=i+d,n=a+o;if(!(h>=0&&h<t.worldMapWidth/t.mapSizeWidth))return"continue";if(!(n>=0&&n<t.worldMapHeight/t.mapSizeHeight))return"continue";var l="TiledMap_"+h+"_"+n,p=s(l,t.MapNode);if(e||!p){p&&p.destroy();var M=c(t.mapPab);M.parent=t.MapNode,M.name=l;var P=M.getComponent(r),u=t.mapSizeY-n-1;f.load("TILEDMAP/map/map_"+h+"_"+u,y,(function(e,t){e?console.error(e.message):(console.log("TILEDMAP/map/map_"+h+"_"+u+" ooko"),P.tmxAsset=t)})),M.setPosition(h*t.mapSizeWidth,n*t.mapSizeHeight,0)}},P=-1;P<=1;P++)M(P)}},i.upDatePlayerLocal=function(){this.PlayerNode.setPosition(this.worldMapX+this.worldPlayerX,this.worldMapY+this.worldPlayerY)},i.onLoad=function(){n.on(l.EventType.KEY_DOWN,this.onKeyDown,this),n.on(l.EventType.KEY_UP,this.onKeyUp,this)},i.onDestroy=function(){n.off(l.EventType.KEY_DOWN,this.onKeyDown,this),n.off(l.EventType.KEY_UP,this.onKeyUp,this)},i.update=function(e){this.updateKeyOff(),this.HandleMove(e)},i.HandleMoveUtile=function(e){return this.mapIsCanMove(e.x,e.y)?(this.worldPlayerX=e.x,this.worldPlayerY=e.y,!0):(console.log("不能移动："+e.x+" "+e.y),!1)},i.HandleMove=function(e){var t=e/this.FrameTime*this.SPEED;if(null!=this.moveAngle){var i={x:this.worldPlayerX,y:this.worldPlayerY},a=m.inst.Point2PointFAngle(i,t,this.moveAngle);if(console.log("nextPix = "+a.x+" "+a.y),a=this.checkMapPix(a),!this.HandleMoveUtile(a)){var o=this.moveAngle;o>Math.PI/2&&o<Math.PI?(a=m.inst.Point2PointFAngle(i,t,Math.PI/2),a=this.checkMapPix(a),this.HandleMoveUtile(a)||(a=m.inst.Point2PointFAngle(i,t,Math.PI),a=this.checkMapPix(a),this.HandleMoveUtile(a))):o<Math.PI/2&&o>0?(a=m.inst.Point2PointFAngle(i,t,0),a=this.checkMapPix(a),this.HandleMoveUtile(a)||(a=m.inst.Point2PointFAngle(i,t,Math.PI/2),a=this.checkMapPix(a),this.HandleMoveUtile(a))):o<0&&o>-Math.PI/2?(a=m.inst.Point2PointFAngle(i,t,-Math.PI/2),a=this.checkMapPix(a),this.HandleMoveUtile(a)||(a=m.inst.Point2PointFAngle(i,t,0),a=this.checkMapPix(a),this.HandleMoveUtile(a))):o>-Math.PI&&o<-Math.PI/2&&(a=m.inst.Point2PointFAngle(i,t,Math.PI),a=this.checkMapPix(a),this.HandleMoveUtile(a)||(a=m.inst.Point2PointFAngle(i,t,-Math.PI/2),a=this.checkMapPix(a),this.HandleMoveUtile(a)))}this.upDateMap()}},i.updateKeyOff=function(){if(this.KeyOffX<0?this.PlayerNode.setScale(-1,1):this.KeyOffX>0&&this.PlayerNode.setScale(1,1),0!=this.KeyOffY&&0!=this.KeyOffX)this.moveAngle=m.inst.PointAngle({x:0,y:0},{x:this.KeyOffX/this.SPEED*this.SPEED/Math.sqrt(2),y:this.KeyOffY/this.SPEED*this.SPEED/Math.sqrt(2)}),this.setPlayerState("run");else if(0!=this.KeyOffY)this.moveAngle=m.inst.PointAngle({x:0,y:0},{x:0,y:this.KeyOffY}),this.setPlayerState("run");else{if(0==this.KeyOffX)return this.moveAngle=null,void this.setPlayerState("stand");this.moveAngle=m.inst.PointAngle({x:0,y:0},{x:this.KeyOffX,y:0}),this.setPlayerState("run")}},i.checkMapPix=function(e){var t=10,i=10;return e.x<t?e.x=t:e.x>=this.worldMapWidth-t&&(e.x=this.worldMapWidth-t-1),e.y<i?e.y=i:e.y>=this.worldMapHeight-i&&(e.y=this.worldMapHeight-i-1),e},i.mapIsCanMove=function(e,t){var i="TiledMap_"+Math.floor(e/this.mapSizeWidth)+"_"+Math.floor(t/this.mapSizeHeight),a=s(i,this.MapNode);if(!a)return console.error("不存在"+i),!1;var o=a.getComponent(r);console.log("tTiledMap.name="+o.name),console.log("tTiledMap.tmxAsset.name="+o.tmxAsset.name);var h=o.getLayer("pz");e%=this.mapSizeWidth,t%=this.mapSizeHeight;var n=Math.floor(e/this.cellWidth),l=19-Math.floor(t/this.cellHeight),p=h.getTileGIDAt(n,l);return console.log(n+"  "+l+" tGid = "+p),0==p},i.setPlayerState=function(e){this.PlayerSpine.animation!=e&&(this.PlayerSpine.animation=e)},i.onTouchStart=function(e){console.log("onTouchStart!!!"),console.log(e.getUILocation());e.getUILocation(),this.getMapCellXY()},i.getMapCellXY=function(){return{x:this.MapNode.position.x+this.viewSize.width/2,y:this.MapNode.position.y+this.viewSize.height/2}},i.onKeyDown=function(e){switch(e.keyCode){case p.ARROW_UP:case p.KEY_W:this.KeyOffY=this.SPEED;break;case p.ARROW_DOWN:case p.KEY_S:this.KeyOffY=-this.SPEED;break;case p.ARROW_LEFT:case p.KEY_A:this.KeyOffX=-this.SPEED;break;case p.ARROW_RIGHT:case p.KEY_D:this.KeyOffX=this.SPEED}},i.onKeyUp=function(e){switch(e.keyCode){case p.ARROW_UP:case p.KEY_W:this.KeyOffY>0&&(this.KeyOffY=0);break;case p.ARROW_DOWN:case p.KEY_S:this.KeyOffY<0&&(this.KeyOffY=0);break;case p.ARROW_LEFT:case p.KEY_A:this.KeyOffX<0&&(this.KeyOffX=0);break;case p.ARROW_RIGHT:case p.KEY_D:this.KeyOffX>0&&(this.KeyOffX=0)}},t}(d)).prototype,"mapPab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=Y))||K));t._RF.pop()}}}));

System.register("chunks:///_virtual/BaseLayer.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./fairygui.mjs"],(function(e){"use strict";var t,n,s,r;return{setters:[function(e){t=e.cclegacy,n=e._decorator},function(e){s=e.inheritsLoose},function(e){r=e.GComponent}],execute:function(){var i;t._RF.push({},"d77e4Rn+HBKDrYzPhdqRTx4","BaseLayer",void 0);var o=n.ccclass;n.property,e("BaseLayer",o("BaseLayer")(i=function(e){function t(){return e.apply(this,arguments)||this}s(t,e);var n=t.prototype;return n.start=function(){this.RegisterEvents()},n.Close=function(){this.UnregisterEvents(),this.dispose()},n.RegisterEvents=function(){},n.UnregisterEvents=function(){},t}(r))||i);t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./GameUtil.ts","./JsonUtils.ts","./BaseLayer.ts","./CommonTips.ts","./CreateConfirmView.ts","./ConfigUtil.ts","./CreateRoleView.ts","./LoadingView.ts","./BagLayer.ts","./main.ts","./player.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});